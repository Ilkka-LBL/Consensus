

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Consensus.EsriServers module &mdash; Consensus 1.2.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=ca842793"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Consensus.GeocodeMerger module" href="Consensus.GeocodeMerger.html" />
    <link rel="prev" title="Consensus.EsriConnector module" href="Consensus.EsriConnector.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Consensus
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">Consensus</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Consensus.ConfigManager.html">Consensus.ConfigManager module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.EsriConnector.html">Consensus.EsriConnector module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Consensus.EsriServers module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography"><code class="docutils literal notranslate"><span class="pre">OpenGeography</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.__init__"><code class="docutils literal notranslate"><span class="pre">OpenGeography.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography._fetch_response"><code class="docutils literal notranslate"><span class="pre">OpenGeography._fetch_response()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography._initialise"><code class="docutils literal notranslate"><span class="pre">OpenGeography._initialise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography._load_all_services"><code class="docutils literal notranslate"><span class="pre">OpenGeography._load_all_services()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography._name"><code class="docutils literal notranslate"><span class="pre">OpenGeography._name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.base_url"><code class="docutils literal notranslate"><span class="pre">OpenGeography.base_url</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.build_lookup"><code class="docutils literal notranslate"><span class="pre">OpenGeography.build_lookup()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.connect_to_server"><code class="docutils literal notranslate"><span class="pre">OpenGeography.connect_to_server()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.field_matching_condition"><code class="docutils literal notranslate"><span class="pre">OpenGeography.field_matching_condition()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.get_layer_obj"><code class="docutils literal notranslate"><span class="pre">OpenGeography.get_layer_obj()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.metadata_as_pandas"><code class="docutils literal notranslate"><span class="pre">OpenGeography.metadata_as_pandas()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.print_all_services"><code class="docutils literal notranslate"><span class="pre">OpenGeography.print_all_services()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.print_object_data"><code class="docutils literal notranslate"><span class="pre">OpenGeography.print_object_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.select_layers_by_layers"><code class="docutils literal notranslate"><span class="pre">OpenGeography.select_layers_by_layers()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.OpenGeography.select_layers_by_service"><code class="docutils literal notranslate"><span class="pre">OpenGeography.select_layers_by_service()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Consensus.EsriServers.TFL"><code class="docutils literal notranslate"><span class="pre">TFL</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.__init__"><code class="docutils literal notranslate"><span class="pre">TFL.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL._fetch_response"><code class="docutils literal notranslate"><span class="pre">TFL._fetch_response()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL._initialise"><code class="docutils literal notranslate"><span class="pre">TFL._initialise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL._load_all_services"><code class="docutils literal notranslate"><span class="pre">TFL._load_all_services()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL._name"><code class="docutils literal notranslate"><span class="pre">TFL._name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.base_url"><code class="docutils literal notranslate"><span class="pre">TFL.base_url</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.build_lookup"><code class="docutils literal notranslate"><span class="pre">TFL.build_lookup()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.connect_to_server"><code class="docutils literal notranslate"><span class="pre">TFL.connect_to_server()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.field_matching_condition"><code class="docutils literal notranslate"><span class="pre">TFL.field_matching_condition()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.get_layer_obj"><code class="docutils literal notranslate"><span class="pre">TFL.get_layer_obj()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.metadata_as_pandas"><code class="docutils literal notranslate"><span class="pre">TFL.metadata_as_pandas()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.print_all_services"><code class="docutils literal notranslate"><span class="pre">TFL.print_all_services()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.print_object_data"><code class="docutils literal notranslate"><span class="pre">TFL.print_object_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.select_layers_by_layers"><code class="docutils literal notranslate"><span class="pre">TFL.select_layers_by_layers()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.EsriServers.TFL.select_layers_by_service"><code class="docutils literal notranslate"><span class="pre">TFL.select_layers_by_service()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.GeocodeMerger.html">Consensus.GeocodeMerger module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.LGInform.html">Consensus.LGInform module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.LocalMerger.html">Consensus.LocalMerger module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.Nomis.html">Consensus.Nomis module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.config_utils.html">Consensus.config_utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.utils.html">Consensus.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.server_selector_util.html">Consensus.server_selector_util module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.config.html">Consensus.config folder</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.lookups.html">Consensus.lookups folder</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.PickleJar.html">Consensus.PickleJar folder</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Consensus</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">Consensus</a></li>
      <li class="breadcrumb-item active">Consensus.EsriServers module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Consensus.EsriServers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-Consensus.EsriServers">
<span id="consensus-esriservers-module"></span><h1>Consensus.EsriServers module<a class="headerlink" href="#module-Consensus.EsriServers" title="Link to this heading"></a></h1>
<p>This module contains classes that connect to Esri Servers and download data from them. It is designed to be used in conjunction with the <code class="docutils literal notranslate"><span class="pre">Consensus.EsriConnector</span></code> module’s <code class="docutils literal notranslate"><span class="pre">FeatureServer()</span></code> class.</p>
<dl class="py class">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Consensus.EsriServers.</span></span><span class="sig-name descname"><span class="pre">OpenGeography</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="Consensus.EsriConnector.html#Consensus.EsriConnector.EsriConnector" title="Consensus.EsriConnector.EsriConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">EsriConnector</span></code></a></p>
<section id="open-geography-portal">
<h2>Open Geography Portal<a class="headerlink" href="#open-geography-portal" title="Link to this heading"></a></h2>
<p>This module provides a class <code class="docutils literal notranslate"><span class="pre">OpenGeography()</span></code> that connects to the Open Geography Portal API.</p>
<p>Running <code class="docutils literal notranslate"><span class="pre">OpenGeography().build_lookup()</span></code> is necessary if you want to make use of the <code class="docutils literal notranslate"><span class="pre">SmartLinker()</span></code> class from the GeocodeMerger module.</p>
</section>
<section id="usage">
<h2>Usage:<a class="headerlink" href="#usage" title="Link to this heading"></a></h2>
<p>This module works in the same way as the <code class="docutils literal notranslate"><span class="pre">EsriConnector()</span></code> class, but it is specifically designed for the Open Geography Portal API. It relies on <code class="docutils literal notranslate"><span class="pre">build_lookup()</span></code> method that creates a lookup table for the portal’s FeatureServers and saves it to a JSON file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Consensus.EsriServers</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenGeography</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">build_ogp_lookup</span><span class="p">()</span>
    <span class="n">og</span> <span class="o">=</span> <span class="n">OpenGeography</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">og</span><span class="o">.</span><span class="n">build_lookup</span><span class="p">()</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">build_ogp_lookup</span><span class="p">())</span>
</pre></div>
</div>
<p>As with any <code class="docutils literal notranslate"><span class="pre">EsriConnector()</span></code> sub-class, you can combine <code class="docutils literal notranslate"><span class="pre">OpenGeography()</span></code> with the <code class="docutils literal notranslate"><span class="pre">FeatureServer()</span></code> class to download data from the portal’s FeatureServers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Consensus.EsriConnector</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeatureServer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Consensus.EsriServers</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenGeography</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Consensus.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">where_clause_maker</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_test_data</span><span class="p">():</span>
    <span class="n">og</span> <span class="o">=</span> <span class="n">OpenGeography</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">retry_delay</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">fs</span> <span class="o">=</span> <span class="n">FeatureServer</span><span class="p">()</span>

    <span class="n">column_name</span> <span class="o">=</span> <span class="s1">&#39;WD23NM&#39;</span>
    <span class="n">geographic_areas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Brockley&#39;</span><span class="p">]</span>
    <span class="n">service_name</span> <span class="o">=</span> <span class="s1">&#39;Wards_December_2023_Boundaries_UK_BSC&#39;</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="n">og</span><span class="o">.</span><span class="n">select_layers_by_service</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">service_name</span><span class="p">)</span>  <span class="c1"># choose the first layer of the &#39;Wards_December_2023_Boundaries_UK_BSC&#39; service</span>
    <span class="n">layer_full_name</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">full_name</span>  <span class="c1"># use the layer&#39;s ``full_name`` attribute to select it in ``fs.setup()``</span>

    <span class="n">where_clause</span> <span class="o">=</span> <span class="n">where_clause_maker</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">geographic_areas</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column_name</span><span class="p">)</span>  <span class="c1"># a helper function that creates the SQL where clause for Esri Servers</span>

    <span class="k">await</span> <span class="n">fs</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">full_name</span><span class="o">=</span><span class="n">layer_full_name</span><span class="p">,</span> <span class="n">esri_server</span><span class="o">=</span><span class="n">og</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">retry_delay</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fs</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">where_clause</span><span class="o">=</span><span class="n">where_clause</span><span class="p">,</span> <span class="n">return_geometry</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">download_test_data</span><span class="p">())</span>
</pre></div>
</div>
<p>However, it is perhaps best to rely on the <code class="docutils literal notranslate"><span class="pre">GeocodeMerger.SmartLinker()</span></code> class for more complex downloads from the Open Geography Portal.</p>
<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialise class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>*args</strong> – Arguments for the <code class="docutils literal notranslate"><span class="pre">EsriConnector()</span></code> class.</p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments for the <code class="docutils literal notranslate"><span class="pre">EsriConnector()</span></code> class.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography._fetch_response">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_fetch_response</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography._fetch_response" title="Link to this definition"></a></dt>
<dd><p>Helper method to fetch the response from the Esri server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>session</strong> (<em>aiohttp.ClientSession</em>) – The aiohttp.ClientSession object.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The JSON response from the Esri server.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography._initialise">
<span class="sig-name descname"><span class="pre">_initialise</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography._initialise" title="Link to this definition"></a></dt>
<dd><p>Initialise the class by either reading the saved service table from a pickle file or by setting it as an empty dictionary ready to be filled with <code class="docutils literal notranslate"><span class="pre">build_lookup()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography._load_all_services">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_load_all_services</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography._load_all_services" title="Link to this definition"></a></dt>
<dd><p>Load services into a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography._name">
<span class="sig-name descname"><span class="pre">_name</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'Open_Geography_Portal'</span></em><a class="headerlink" href="#Consensus.EsriServers.OpenGeography._name" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.base_url">
<span class="sig-name descname"><span class="pre">base_url</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services?f=json'</span></em><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.base_url" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.build_lookup">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">build_lookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">PosixPath('/home/runner/work/Consensus/Consensus/Consensus')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">included_services</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replace_old</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.build_lookup" title="Link to this definition"></a></dt>
<dd><p>Build a lookup table from scratch and save it to a JSON file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parent_path</strong> (<em>Path</em>) – Parent path to save the service_table pickle and lookup files.</p></li>
<li><p><strong>included_services</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – List of services to include in the lookup. Defaults to [], which is interpreted as as ‘all’.</p></li>
<li><p><strong>replace_old</strong> (<em>bool</em>) – Whether to replace the old lookup file. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The lookup table as a pandas DataFrame.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.connect_to_server">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">connect_to_server</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.connect_to_server" title="Link to this definition"></a></dt>
<dd><p>Run this method to initialise the class session.
Validate access to the base URL asynchronously using aiohttp. When a response is received, call <code class="docutils literal notranslate"><span class="pre">_load_all_services()</span></code> to load services into a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.field_matching_condition">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">field_matching_condition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">field</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.field_matching_condition" title="Link to this definition"></a></dt>
<dd><p>Condition for matchable fields. This method is used by <code class="docutils literal notranslate"><span class="pre">Service()</span></code> to filter the fields that are added to the matchable_fields columns, which is subsequently used by <code class="docutils literal notranslate"><span class="pre">SmartLinker()</span></code> for matching data tables.
This method is meant to be overwritten by the user if they want to change the condition for matchable fields. Each Esri ArcGIS server will have its own rules, so this will be left for the user to deal with.
If you are using a built-in server (e.g. TFL or Open Geography Portal), then you don’t have to touch this method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>field</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em>]</em>) – The field dictionary. This is the input coming from <code class="docutils literal notranslate"><span class="pre">Service()</span></code>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the field ends with ‘CD’ or ‘NM’ and the last 4 characters before the end are numeric, or if the field is in the matchable_fields_extension list, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.get_layer_obj">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_layer_obj</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">service</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.get_layer_obj" title="Link to this definition"></a></dt>
<dd><p>Fetch metadata for a service and add it to the service table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>service</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em>]</em>) – Dictionary of services.</p></li>
<li><p><strong>session</strong> (<em>aiohttp.ClientSession</em>) – The aiohttp.ClientSession object.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.metadata_as_pandas">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">metadata_as_pandas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">included_services</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.metadata_as_pandas" title="Link to this definition"></a></dt>
<dd><p>Asynchronously create a Pandas DataFrame of selected tables’ metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>included_services</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – A list of service names to include in the DataFrame. If empty, all services are included.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A DataFrame containing the metadata of the selected services.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.print_all_services">
<span class="sig-name descname"><span class="pre">print_all_services</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.print_all_services" title="Link to this definition"></a></dt>
<dd><p>Print name, type, and URL of all services available through Esri server.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.print_object_data">
<span class="sig-name descname"><span class="pre">print_object_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer_obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.print_object_data" title="Link to this definition"></a></dt>
<dd><p>Print the data of a Layer object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>layer_obj</strong> (<a class="reference internal" href="Consensus.EsriConnector.html#Consensus.EsriConnector.Layer" title="Consensus.EsriConnector.Layer"><em>Layer</em></a>) – The Layer object to print.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p>Added in version 1.1.1.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.select_layers_by_layers">
<span class="sig-name descname"><span class="pre">select_layers_by_layers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.select_layers_by_layers" title="Link to this definition"></a></dt>
<dd><p>Print a subset of the service table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>layer_name</strong> (<em>str</em>) – The name of the layer to print.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of Layer objects for the selected service.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[Any]</p>
</dd>
</dl>
<p>Added in version 1.1.0</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.OpenGeography.select_layers_by_service">
<span class="sig-name descname"><span class="pre">select_layers_by_service</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">service_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.OpenGeography.select_layers_by_service" title="Link to this definition"></a></dt>
<dd><p>Print and output a subset of the service table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>service_name</strong> (<em>str</em>) – The name of the service to print.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of Layer objects for the selected service.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[Any]</p>
</dd>
</dl>
<p>Added in version 1.1.0</p>
</dd></dl>

</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Consensus.EsriServers.</span></span><span class="sig-name descname"><span class="pre">TFL</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="Consensus.EsriConnector.html#Consensus.EsriConnector.EsriConnector" title="Consensus.EsriConnector.EsriConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">EsriConnector</span></code></a></p>
<p>—</p>
<p>This module contains the TFL class, which is a subclass of <code class="docutils literal notranslate"><span class="pre">EsriConnector()</span></code>. It is used to connect to the TfL Open Data Hub and retrieve data.</p>
<section id="id1">
<h2>Usage:<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Consensus.EsriServers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TFL</span>

<span class="n">tfl</span> <span class="o">=</span> <span class="n">TFL</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">retry_delay</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">tfl</span><span class="o">.</span><span class="n">print_all_services</span><span class="p">()</span>  <span class="c1"># a method to help you choose which service you&#39;d like to download data for.</span>
</pre></div>
</div>
<p>The above code will connect to the TfL Open Data Hub and print all available services. You select the service you want to connect to by copying the service name string that comes after “Service name:” in the output.</p>
<p>Let’s say you want to view the bus stops data and explore the metadata:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Consensus.EsriServers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TFL</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">minimal</span><span class="p">():</span>
    <span class="n">tfl</span> <span class="o">=</span> <span class="n">TFL</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">retry_delay</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tfl</span><span class="o">.</span><span class="n">metadata_as_pandas</span><span class="p">(</span><span class="n">included_services</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Bus_Stops&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">minimal</span><span class="p">())</span>
</pre></div>
</div>
<p>This will connect to the TfL Open Data Hub and retrieve all available data for Bus_Stops service. From here, you can create a <cite>where</cite> clause to further fine-tune your query:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Consensus.EsriServers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TFL</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Consensus.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">where_clause_maker</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_test_data</span><span class="p">():</span>
    <span class="n">tfl</span> <span class="o">=</span> <span class="n">TFL</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">retry_delay</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">fs</span> <span class="o">=</span> <span class="n">FeatureServer</span><span class="p">()</span>

    <span class="n">service_name</span> <span class="o">=</span> <span class="s1">&#39;Bus_Stops&#39;</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="n">tfl</span><span class="o">.</span><span class="n">select_layers_by_service</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">service_name</span><span class="p">)</span>  <span class="c1"># choose the first layer of the &#39;Bus_Stops&#39; service</span>
    <span class="n">layer_full_name</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">full_name</span>  <span class="c1"># use the layer&#39;s ``full_name`` attribute to select it in ``fs.setup()`` and when creating the ``where_clause``</span>


    <span class="n">column_name</span> <span class="o">=</span> <span class="s1">&#39;STOP_NAME&#39;</span>
    <span class="n">geographic_areas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Hazel Mead&#39;</span><span class="p">]</span>
    <span class="n">where_clause</span> <span class="o">=</span> <span class="n">where_clause_maker</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">geographic_areas</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column_name</span><span class="p">)</span>  <span class="c1"># a helper function that creates the SQL where clause for Esri Servers</span>

    <span class="k">await</span> <span class="n">fs</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">full_name</span><span class="o">=</span><span class="n">layer_full_name</span><span class="p">,</span> <span class="n">esri_server</span><span class="o">=</span><span class="n">tfl</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">retry_delay</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fs</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">where_clause</span><span class="o">=</span><span class="n">where_clause</span><span class="p">,</span> <span class="n">return_geometry</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">download_test_data</span><span class="p">())</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialise class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>*args</strong> – Arguments for the EsriConnector class.</p></li>
<li><p><strong>**kwargs</strong> – Keyword arguments for the EsriConnector class.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL._fetch_response">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_fetch_response</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL._fetch_response" title="Link to this definition"></a></dt>
<dd><p>Helper method to fetch the response from the Esri server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>session</strong> (<em>aiohttp.ClientSession</em>) – The aiohttp.ClientSession object.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The JSON response from the Esri server.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL._initialise">
<span class="sig-name descname"><span class="pre">_initialise</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL._initialise" title="Link to this definition"></a></dt>
<dd><p>Initialise the class by either reading the saved service table from a pickle file or by setting it as an empty dictionary ready to be filled with <code class="docutils literal notranslate"><span class="pre">build_lookup()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL._load_all_services">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_load_all_services</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL._load_all_services" title="Link to this definition"></a></dt>
<dd><p>Load services into a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL._name">
<span class="sig-name descname"><span class="pre">_name</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'TFL'</span></em><a class="headerlink" href="#Consensus.EsriServers.TFL._name" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.base_url">
<span class="sig-name descname"><span class="pre">base_url</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'https://services1.arcgis.com/YswvgzOodUvqkoCN/ArcGIS/rest/services?f=json'</span></em><a class="headerlink" href="#Consensus.EsriServers.TFL.base_url" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.build_lookup">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">build_lookup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parent_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">PosixPath('/home/runner/work/Consensus/Consensus/Consensus')</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">included_services</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replace_old</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL.build_lookup" title="Link to this definition"></a></dt>
<dd><p>Build a lookup table from scratch and save it to a JSON file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parent_path</strong> (<em>Path</em>) – Parent path to save the service_table pickle and lookup files.</p></li>
<li><p><strong>included_services</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – List of services to include in the lookup. Defaults to [], which is interpreted as as ‘all’.</p></li>
<li><p><strong>replace_old</strong> (<em>bool</em>) – Whether to replace the old lookup file. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The lookup table as a pandas DataFrame.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.connect_to_server">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">connect_to_server</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL.connect_to_server" title="Link to this definition"></a></dt>
<dd><p>Run this method to initialise the class session.
Validate access to the base URL asynchronously using aiohttp. When a response is received, call <code class="docutils literal notranslate"><span class="pre">_load_all_services()</span></code> to load services into a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.field_matching_condition">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">field_matching_condition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">field</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL.field_matching_condition" title="Link to this definition"></a></dt>
<dd><p>Condition for matchable fields. This method is used by <code class="docutils literal notranslate"><span class="pre">Service()</span></code> to filter the fields that are added to the matchable_fields columns, which is subsequently used by <code class="docutils literal notranslate"><span class="pre">SmartLinker()</span></code> for matching data tables.
This method is meant to be overwritten by the user if they want to change the condition for matchable fields. Each Esri ArcGIS server will have its own rules, so this will be left for the user to deal with.
If you are using a built-in server (e.g. TFL or Open Geography Portal), then you don’t have to touch this method.</p>
<p>The current implementation for this class will return no columns other than the columns listed in matchable_fields_extension.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>field</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em>]</em>) – The field dictionary. This is the input coming from <code class="docutils literal notranslate"><span class="pre">Service()</span></code>.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the field ends with ‘CD’ or ‘NM’ and the last 4 characters before the end are numeric, or if the field is in the matchable_fields_extension list, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.get_layer_obj">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_layer_obj</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">service</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL.get_layer_obj" title="Link to this definition"></a></dt>
<dd><p>Fetch metadata for a service and add it to the service table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>service</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em>]</em>) – Dictionary of services.</p></li>
<li><p><strong>session</strong> (<em>aiohttp.ClientSession</em>) – The aiohttp.ClientSession object.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.metadata_as_pandas">
<em class="property"><span class="pre">async</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">metadata_as_pandas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">included_services</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL.metadata_as_pandas" title="Link to this definition"></a></dt>
<dd><p>Asynchronously create a Pandas DataFrame of selected tables’ metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>included_services</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – A list of service names to include in the DataFrame. If empty, all services are included.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A DataFrame containing the metadata of the selected services.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.print_all_services">
<span class="sig-name descname"><span class="pre">print_all_services</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL.print_all_services" title="Link to this definition"></a></dt>
<dd><p>Print name, type, and URL of all services available through Esri server.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.print_object_data">
<span class="sig-name descname"><span class="pre">print_object_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer_obj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL.print_object_data" title="Link to this definition"></a></dt>
<dd><p>Print the data of a Layer object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>layer_obj</strong> (<a class="reference internal" href="Consensus.EsriConnector.html#Consensus.EsriConnector.Layer" title="Consensus.EsriConnector.Layer"><em>Layer</em></a>) – The Layer object to print.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p>Added in version 1.1.1.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.select_layers_by_layers">
<span class="sig-name descname"><span class="pre">select_layers_by_layers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL.select_layers_by_layers" title="Link to this definition"></a></dt>
<dd><p>Print a subset of the service table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>layer_name</strong> (<em>str</em>) – The name of the layer to print.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of Layer objects for the selected service.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[Any]</p>
</dd>
</dl>
<p>Added in version 1.1.0</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.EsriServers.TFL.select_layers_by_service">
<span class="sig-name descname"><span class="pre">select_layers_by_service</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">service_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.EsriServers.TFL.select_layers_by_service" title="Link to this definition"></a></dt>
<dd><p>Print and output a subset of the service table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>service_name</strong> (<em>str</em>) – The name of the service to print.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of Layer objects for the selected service.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[Any]</p>
</dd>
</dl>
<p>Added in version 1.1.0</p>
</dd></dl>

</section>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Consensus.EsriConnector.html" class="btn btn-neutral float-left" title="Consensus.EsriConnector module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Consensus.GeocodeMerger.html" class="btn btn-neutral float-right" title="Consensus.GeocodeMerger module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Ilkka Sipila - Lewisham Council Data Science and Insight team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>