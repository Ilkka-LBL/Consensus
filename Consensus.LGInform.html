

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Consensus.LGInform module &mdash; Consensus 1.2.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=ca842793"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Consensus.LocalMerger module" href="Consensus.LocalMerger.html" />
    <link rel="prev" title="Consensus.GeocodeMerger module" href="Consensus.GeocodeMerger.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Consensus
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">Consensus</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Consensus.ConfigManager.html">Consensus.ConfigManager module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.EsriConnector.html">Consensus.EsriConnector module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.EsriServers.html">Consensus.EsriServers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.GeocodeMerger.html">Consensus.GeocodeMerger module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Consensus.LGInform module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Consensus.LGInform.LGInform"><code class="docutils literal notranslate"><span class="pre">LGInform</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.api_key"><code class="docutils literal notranslate"><span class="pre">LGInform.api_key</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.api_secret"><code class="docutils literal notranslate"><span class="pre">LGInform.api_secret</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.proxies"><code class="docutils literal notranslate"><span class="pre">LGInform.proxies</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.area"><code class="docutils literal notranslate"><span class="pre">LGInform.area</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.__init__"><code class="docutils literal notranslate"><span class="pre">LGInform.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform._multiprocessing_wrapper"><code class="docutils literal notranslate"><span class="pre">LGInform._multiprocessing_wrapper()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.download"><code class="docutils literal notranslate"><span class="pre">LGInform.download()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.download_data_for_many_variables"><code class="docutils literal notranslate"><span class="pre">LGInform.download_data_for_many_variables()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.download_variable_data"><code class="docutils literal notranslate"><span class="pre">LGInform.download_variable_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.format_tables"><code class="docutils literal notranslate"><span class="pre">LGInform.format_tables()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.get_dataset_table_variables"><code class="docutils literal notranslate"><span class="pre">LGInform.get_dataset_table_variables()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.json_to_pandas"><code class="docutils literal notranslate"><span class="pre">LGInform.json_to_pandas()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.merge_tables"><code class="docutils literal notranslate"><span class="pre">LGInform.merge_tables()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.mp_download"><code class="docutils literal notranslate"><span class="pre">LGInform.mp_download()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Consensus.LGInform.LGInform.sign_url"><code class="docutils literal notranslate"><span class="pre">LGInform.sign_url()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.LocalMerger.html">Consensus.LocalMerger module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.Nomis.html">Consensus.Nomis module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.config_utils.html">Consensus.config_utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.utils.html">Consensus.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.server_selector_util.html">Consensus.server_selector_util module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.config.html">Consensus.config folder</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.lookups.html">Consensus.lookups folder</a></li>
<li class="toctree-l2"><a class="reference internal" href="Consensus.PickleJar.html">Consensus.PickleJar folder</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Consensus</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">Consensus</a></li>
      <li class="breadcrumb-item active">Consensus.LGInform module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Consensus.LGInform.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-Consensus.LGInform">
<span id="consensus-lginform-module"></span><h1>Consensus.LGInform module<a class="headerlink" href="#module-Consensus.LGInform" title="Link to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Consensus.LGInform.</span></span><span class="sig-name descname"><span class="pre">LGInform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">api_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">api_secret</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proxies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'E09000023,Lewisham_CIPFA_Near_Neighbours'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>The class takes a dictionary of LG Inform datasets (such as {‘IMD_2010’: 841, ‘IMD_2009’: 842, ‘Death_of_enterprises’: 102}), finds all metrics, downloads the data, and merges them into one. The dictionary keys can be any string of your choosing, but the integer values must be one of <a class="reference external" href="https://webservices.esd.org.uk/datasets?ApplicationKey=ExamplePPK&amp;Signature=YChwR9HU0Vbg8KZ5ezdGZt+EyL4=">https://webservices.esd.org.uk/datasets?ApplicationKey=ExamplePPK&amp;Signature=YChwR9HU0Vbg8KZ5ezdGZt+EyL4=</a>
The main method to download data for multiple datasets is the <code class="docutils literal notranslate"><span class="pre">mp_download()</span></code> method, which uses multiprocessing to download data from multiple datasets simultaneously. However, this requires that the class is called within <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code>.
If multiprocessing is not necessary, it’s better to use <code class="docutils literal notranslate"><span class="pre">download()</span></code> method, which is what the multiprocessing wrapper method also calls.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.api_key">
<span class="sig-name descname"><span class="pre">api_key</span></span><a class="headerlink" href="#Consensus.LGInform.LGInform.api_key" title="Link to this definition"></a></dt>
<dd><p>Application Key to LG Inform Plus.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.api_secret">
<span class="sig-name descname"><span class="pre">api_secret</span></span><a class="headerlink" href="#Consensus.LGInform.LGInform.api_secret" title="Link to this definition"></a></dt>
<dd><p>Application Secret to LG Inform Plus.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.proxies">
<span class="sig-name descname"><span class="pre">proxies</span></span><a class="headerlink" href="#Consensus.LGInform.LGInform.proxies" title="Link to this definition"></a></dt>
<dd><p>Proxy address if known.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict[str, str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.area">
<span class="sig-name descname"><span class="pre">area</span></span><a class="headerlink" href="#Consensus.LGInform.LGInform.area" title="Link to this definition"></a></dt>
<dd><p>A comma separated string of areas, excluding whitespace. You can either use GSS codes or use LG Inform’s off-the-shelf groups for areas. For instance, Lewisham GSS code is E09000023 and it’s CIPFA nearest neighbours is called Lewisham_CIPFA_Near_Neighbours. Together these would be input as ‘E09000023,Lewisham_CIPFA_Near_Neighbours’.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">json_to_pandas(json_data</span></span></dt>
<dd><p>JSONDict): Transform downloaded json data to Pandas dataframe.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">sign_url(url</span></span></dt>
<dd><p>str): Sign all url calls with your unique secret and key.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">download_variable_data(identifier</span></span></dt>
<dd><p>int, latest_n: int): Download data for a given metricType, area, and period.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">download_data_for_many_variables(variables</span></span></dt>
<dd><p>JSONDict, latest_n: int = 20, arraytype: str = ‘metricType-array’): Download the variables for an array of metricTypes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get_dataset_table_variables(dataset</span></span></dt>
<dd><p>int): Given a dataset, output all the metricType numbers (dataset columns).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">format_tables(outputs</span></span></dt>
<dd><p>List[JSONDict], drop_discontinued: bool = True): Format the data for each variable and create a metadata table.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">merge_tables(dataset_name</span></span></dt>
<dd><p>str): Merge the variables to form a table for a given dataset.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">download(datasets</span></span></dt>
<dd><p>Dict[str, int], output_folder: Path, latest_n: int = 5, drop_discontinued: bool = True): Download data for one or more datasets.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">mp_download(datasets</span></span></dt>
<dd><p>Dict[str, int], output_folder: Path, latest_n: int = 20, drop_discontinued: bool = True, max_workers: int = 8): Multiprocessing wrapper to download data for multiple datasets simultaneously.</p>
</dd></dl>

<p>Usage:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Consensus.LGInform</span><span class="w"> </span><span class="kn">import</span> <span class="n">LGInform</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Consensus.ConfigManager</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigManager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">os</span><span class="w"> </span><span class="kn">import</span> <span class="n">environ</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="n">dotenv_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">)</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="n">dotenv_path</span><span class="p">)</span>


<span class="n">lg_key</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LG_KEY&quot;</span><span class="p">)</span>  <span class="c1"># public key to LG Inform Plus</span>
<span class="n">lg_secret</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LG_SECRET&quot;</span><span class="p">)</span>  <span class="c1"># secret to LG Inform Plus</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">ConfigManager</span><span class="p">()</span>  <span class="c1"># Use ConfigManager to save environment variables and proxy address if you want the information to be stored with this package</span>
<span class="n">conf</span><span class="o">.</span><span class="n">update_config</span><span class="p">(</span><span class="s2">&quot;lg_inform_key&quot;</span><span class="p">,</span> <span class="n">lg_key</span><span class="p">)</span>
<span class="n">conf</span><span class="o">.</span><span class="n">update_config</span><span class="p">(</span><span class="s2">&quot;lg_inform_secret&quot;</span><span class="p">,</span> <span class="n">lg_secret</span><span class="p">)</span>
<span class="n">out_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./data/mp_test/&#39;</span><span class="p">)</span>  <span class="c1"># folder to store final data</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IMD_2010&#39;</span><span class="p">:</span> <span class="mi">841</span><span class="p">,</span> <span class="s1">&#39;IMD_2009&#39;</span><span class="p">:</span> <span class="mi">842</span><span class="p">,</span> <span class="s1">&#39;Death_of_enterprises&#39;</span><span class="p">:</span> <span class="mi">102</span><span class="p">}</span>  <span class="c1"># a dictionary of datasets. The key can be any string, but the integer value must be an identifier from https://webservices.esd.org.uk/datasets?ApplicationKey=ExamplePPK&amp;Signature=YChwR9HU0Vbg8KZ5ezdGZt+EyL4=</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>  <span class="c1"># when using the multiprocessing wrapper method, you have to run it under if __name__ &#39;__main__&#39; statement.</span>
    <span class="n">api_call</span> <span class="o">=</span> <span class="n">LGInform</span><span class="p">(</span><span class="n">area</span><span class="o">=</span><span class="s1">&#39;E09000023,Lewisham_CIPFA_Near_Neighbours&#39;</span><span class="p">)</span>
    <span class="c1">#api_call.download(datasets=datasets, output_folder=out_folder, latest_n=20, drop_discontinued=False)  # normal, single threaded download</span>
    <span class="n">api_call</span><span class="o">.</span><span class="n">mp_download</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">output_folder</span><span class="o">=</span><span class="n">out_folder</span><span class="p">,</span> <span class="n">latest_n</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">drop_discontinued</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">api_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">api_secret</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proxies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'E09000023,Lewisham_CIPFA_Near_Neighbours'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialise the class with API key, secret, and proxy address.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>api_key</strong> (<em>str</em>) – Application Key to LG Inform Plus.</p></li>
<li><p><strong>api_secret</strong> (<em>str</em>) – Application Secret to LG Inform Plus.</p></li>
<li><p><strong>proxies</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em>]</em>) – Proxy address if known.</p></li>
<li><p><strong>area</strong> (<em>str</em>) – A comma separated string of areas, excluding whitespace. You can either use GSS codes or use LG Inform’s off-the-shelf groups for areas. For instance, Lewisham GSS code is E09000023 and it’s CIPFA nearest neighbours is called Lewisham_CIPFA_Near_Neighbours. Together these would be input as ‘E09000023,Lewisham_CIPFA_Near_Neighbours’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform._multiprocessing_wrapper">
<span class="sig-name descname"><span class="pre">_multiprocessing_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_queue</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform._multiprocessing_wrapper" title="Link to this definition"></a></dt>
<dd><p>This is just the same as download() method, but wrapped to be used with multiprocessing library.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>input_queue</strong> (<em>mp.Queue</em>) – A multiprocessing queue.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.download">
<span class="sig-name descname"><span class="pre">download</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_folder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latest_n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_discontinued</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform.download" title="Link to this definition"></a></dt>
<dd><p>Download all variables for many datasets, merging the variables to one table by area and time period.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datasets</strong> (<em>Dict</em><em>[</em><em>str</em><em>,</em><em>int</em><em>]</em>) – Dictionary of format {“some_name”: some_integer}’, where the integer value is an identifier from <a class="reference external" href="https://webservices.esd.org.uk/datasets?ApplicationKey=ExamplePPK&amp;Signature=YChwR9HU0Vbg8KZ5ezdGZt+EyL4=">https://webservices.esd.org.uk/datasets?ApplicationKey=ExamplePPK&amp;Signature=YChwR9HU0Vbg8KZ5ezdGZt+EyL4=</a></p></li>
<li><p><strong>latest_n</strong> (<em>int</em>) – The period is currently restricted to using the latest n periods. This means that the period can be years, quarters, months, weeks or some other period (e.g. for Indices of Multiple Deprivation, the period refers to publications so that latest_n=2 would get data for 2019 and 2015).</p></li>
<li><p><strong>drop_discontinued</strong> (<em>bool</em>) – If you set this to False, the downloaded data will include discontinued metrics. Default is True.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.download_data_for_many_variables">
<span class="sig-name descname"><span class="pre">download_data_for_many_variables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">variables</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latest_n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arraytype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'metricType-array'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform.download_data_for_many_variables" title="Link to this definition"></a></dt>
<dd><p>Download the variables for an array of metricTypes using download_variable_data method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>variables</strong> (<em>JSONDict</em>) – variables JSON from get_dataset_table_variables method.</p></li>
<li><p><strong>latest_n</strong> (<em>int</em>) – Latest n periods. Period could be year, quarter, month, week, or some other period such as the latest n publications.</p></li>
<li><p><strong>arraytype</strong> (<em>str</em>) – Type of variables to download. Default is metricType-array.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of JSON variables.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[JSONDict]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.download_variable_data">
<span class="sig-name descname"><span class="pre">download_variable_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">identifier</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latest_n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform.download_variable_data" title="Link to this definition"></a></dt>
<dd><p>Download data for a given metricType, area, and period (latest n periods).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>identifier</strong> (<em>int</em>) – metricType integer.</p></li>
<li><p><strong>latest_n</strong> (<em>int</em>) – Latest n periods. Period could be year, quarter, month, week, or some other period such as the latest n publications.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Downloaded data as JSON.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>JSONDict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.format_tables">
<span class="sig-name descname"><span class="pre">format_tables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_discontinued</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform.format_tables" title="Link to this definition"></a></dt>
<dd><p>Format the data for each variable and create a metadata table.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> (<em>List</em><em>[</em><em>JSONDict</em><em>]</em>) – A list of JSONDict objects.</p></li>
<li><p><strong>drop_discontinued</strong> (<em>bool</em>) – Boolean to select whether to include discontinued metrics.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.get_dataset_table_variables">
<span class="sig-name descname"><span class="pre">get_dataset_table_variables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform.get_dataset_table_variables" title="Link to this definition"></a></dt>
<dd><p>Given a dataset, output all the metricType numbers (dataset columns). The output dictionary is a JSON.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dataset</strong> (<em>int</em>) – The number of the dataset from <a class="reference external" href="https://webservices.esd.org.uk/datasets?ApplicationKey=ExamplePPK&amp;Signature=YChwR9HU0Vbg8KZ5ezdGZt+EyL4=">https://webservices.esd.org.uk/datasets?ApplicationKey=ExamplePPK&amp;Signature=YChwR9HU0Vbg8KZ5ezdGZt+EyL4=</a></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A JSON dictionary object</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>JSONDict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.json_to_pandas">
<span class="sig-name descname"><span class="pre">json_to_pandas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">json_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform.json_to_pandas" title="Link to this definition"></a></dt>
<dd><p>Transform downloaded json data to Pandas.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>json_data</strong> (<em>JSONDict</em>) – JSON data to transform.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Downloaded data as Pandas dataframe.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.merge_tables">
<span class="sig-name descname"><span class="pre">merge_tables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform.merge_tables" title="Link to this definition"></a></dt>
<dd><p>Merge the variables to form a table for a given dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dataset_name</strong> (<em>str</em>) – Dataset name string.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>All variables of the dataset merged as one Pandas dataframe.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.mp_download">
<span class="sig-name descname"><span class="pre">mp_download</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datasets</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_folder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latest_n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_discontinued</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform.mp_download" title="Link to this definition"></a></dt>
<dd><p>Multiprocessing method for downloading data for multiple datasets. Use max_workers to split the dataset dictionary to chunks of size max_workers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datasets</strong> (<em>Dict</em><em>[</em><em>str</em><em>,</em><em>int</em><em>]</em>) – Dictionary of format {“some_name”: some_integer}’, where the integer value is an identifier from <a class="reference external" href="https://webservices.esd.org.uk/datasets?ApplicationKey=ExamplePPK&amp;Signature=YChwR9HU0Vbg8KZ5ezdGZt+EyL4=">https://webservices.esd.org.uk/datasets?ApplicationKey=ExamplePPK&amp;Signature=YChwR9HU0Vbg8KZ5ezdGZt+EyL4=</a></p></li>
<li><p><strong>latest_n</strong> (<em>int</em>) – The period is currently restricted to using the latest n periods. This means that the period can be years, quarters, months, weeks or some other period (e.g. for Indices of Multiple Deprivation, the period refers to publications so that latest_n=2 would get data for 2019 and 2015).</p></li>
<li><p><strong>drop_discontinued</strong> (<em>bool</em>) – If you set this to False, the downloaded data will include discontinued metrics. Default is True.</p></li>
<li><p><strong>max_workers</strong> (<em>int</em>) – Set the number of workers for multiprocessing. Typically this would be the number of logical CPUs in your system. This will also process the datasets in chunks, so that if you list 16 datasets in your datasets dictionary and have 8 workers, the script will work through the datasets in two steps (16/8 = 2).</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Consensus.LGInform.LGInform.sign_url">
<span class="sig-name descname"><span class="pre">sign_url</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Consensus.LGInform.LGInform.sign_url" title="Link to this definition"></a></dt>
<dd><p>Each url needs to be signed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>url</strong> (<em>str</em>) – URL to be signed.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Signed URL.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Consensus.GeocodeMerger.html" class="btn btn-neutral float-left" title="Consensus.GeocodeMerger module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Consensus.LocalMerger.html" class="btn btn-neutral float-right" title="Consensus.LocalMerger module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Ilkka Sipila - Lewisham Council Data Science and Insight team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>